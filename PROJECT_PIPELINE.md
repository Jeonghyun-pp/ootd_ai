# 프로젝트 전체 파이프라인 이해

## 전체 구조 요약

이 프로젝트는 **대조학습(Contrastive Learning) 기반 코디 추천 시스템**입니다.

---

## 1️⃣ 실시간 추론 파이프라인 (Inference)

### 입력 처리
```
[사용자 입력]
├─ Text: "미니멀 데이트" (추구미/상황)
└─ 날씨 API → 실시간 날씨 정보

↓

[특징 추출]
├─ Text + 날씨 → MLP → vector (사용자 컨텍스트 벡터)
└─ 옷장 이미지 + 속성 → 사전 계산 → vector (옷 아이템 벡터들)
```

### 유사도 계산 및 추천
```
[벡터 비교]
사용자 컨텍스트 벡터 ⊙ 옷 아이템 벡터들
  ↓ (내적 연산)
Cosine Similarity 계산
  ↓
가장 높은 유사도 선택
  ↓
추천하는 옷 (옷장 내부)
```

### 핵심 포인트
- **MLP**: 사용자 입력(텍스트 + 날씨) → 벡터로 변환
- **사전 계산**: 옷장 아이템들은 미리 벡터로 변환되어 저장
- **내적 연산**: 두 벡터의 유사도 계산 (대조학습 원리)
- **실시간**: 새로운 입력에 대해 즉시 추론

---

## 2️⃣ 학습 파이프라인 (Training)

### 학습 데이터 생성
```
[기존 데이터]
├─ 옷장 이미지 (Img)
└─ 정형 데이터 속성 라벨링 (카테고리, 색상, 태그 등)

↓

[LLM으로 데이터 증강]
LLM이 대량의 학습용 정답 데이터 생성
예: "화이트 셔츠는 봄 날씨에 미니멀 스타일에 걸맞아요"
    "블랙 코트는 겨울 날씨에 포멀 스타일에 적합해요"
    ...

↓

[대조학습용 데이터 구조화]
- 각 이미지별로 (Text, 날씨, 옷) 정답쌍 여러 개 생성
- 배치 사이즈에 동일 이미지가 들어가지 않도록 조정
  (대조학습에서 중요: Positive/Negative 구분)
```

### 모델 학습
```
[MLP 학습]
학습 데이터 → MLP 학습시키기
  ↓
목표: 같은 의미의 (텍스트+날씨, 옷) 쌍은 가깝게,
      다른 의미의 쌍은 멀게 학습
```

---

## 3️⃣ 상세 파이프라인 (첫 번째 이미지)

### 단계별 흐름
```
1. 사용자 입력: "미니멀 데이트"
   ↓
2. LLM: 속성 키워드 확장
   "미니멀 데이트" → "심플, 깔끔, 로맨틱, 캐주얼..."
   ↓
3. CLIP Text Encoder
   확장된 키워드 → 텍스트 임베딩 벡터
   ↓
4. Vector DB: 옷장 이미지
   모든 옷장 아이템이 벡터로 저장됨
   ↓
5. Vector Search: Cosine Similarity
   텍스트 벡터와 옷장 벡터들 비교
   ↓
6. Top-K 후보군 추출
   유사도 높은 상위 K개 선택
   ↓
7. Weather API
   현재 날씨 정보 가져오기
   ↓
8. 날씨 기반 필터링
   Top-K 후보 중 날씨에 맞지 않는 것 제거
   ↓
9. 조합 점수 계산 알고리즘
   남은 후보들에 최종 점수 부여
   ↓
10. 최종 추천 3개 + 설명
    Top 3 선택 및 설명 생성
```

---

## 핵심 아키텍처 이해

### 대조학습의 역할
```
학습 시:
- Positive: "미니멀 데이트" + 날씨 + 옷A → 가깝게
- Negative: "스트릿 파티" + 날씨 + 옷A → 멀게

추론 시:
- 사용자 입력 벡터와 옷장 벡터들의 유사도 계산
- 가장 유사한 옷 = 가장 적합한 추천
```

### 벡터 공간 개념
```
학습된 벡터 공간:
- "미니멀 데이트" 벡터와 "화이트 셔츠" 벡터가 가까움
- "스트릿 파티" 벡터와 "화이트 셔츠" 벡터가 멀음

→ 유사도가 높을수록 적합한 추천
```

---

## 현재 프로젝트와의 연결

### 구현해야 할 부분

1. **LLM 키워드 확장** (현재 없음)
   - 사용자 입력을 LLM으로 확장

2. **CLIP Text Encoder** (현재: 토크나이저만)
   - CLIP 모델로 텍스트 임베딩

3. **Vector DB** (현재 없음)
   - 옷장 아이템 벡터 저장
   - Pinecone, Weaviate, Chroma 등

4. **옷장 이미지 임베딩** (현재 없음)
   - CLIP Image Encoder로 이미지 벡터화

5. **대조학습 구현** (현재: 일반 학습만)
   - Positive/Negative 샘플 구성
   - Contrastive Loss 사용

6. **LLM 데이터 증강** (현재 없음)
   - 학습 데이터 생성

---

## 정리

### 이해한 구조
1. ✅ **실시간 추론**: 사용자 입력 → MLP → 벡터 → 유사도 계산 → 추천
2. ✅ **학습**: LLM 데이터 증강 → 대조학습 → MLP 학습
3. ✅ **벡터 기반**: 모든 것을 벡터로 표현하고 유사도로 비교
4. ✅ **대조학습**: 같은 의미는 가깝게, 다른 의미는 멀게

### 현재 프로젝트 상태
- ❌ LLM 키워드 확장 없음
- ❌ CLIP 사용 안 함 (토크나이저만)
- ❌ Vector DB 없음
- ❌ 이미지 임베딩 없음
- ❌ 대조학습 구현 안 됨
- ✅ 날씨 API 연동됨
- ✅ UI 완성됨

이제 이 구조에 맞춰 구현하면 됩니다!
